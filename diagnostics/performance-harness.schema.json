{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://oods-foundry.dev/schemas/performance-harness.json",
  "title": "Performance Harness Results",
  "description": "Schema for performance metrics captured by the Playwright-based performance harness",
  "type": "object",
  "properties": {
    "performanceHarness": {
      "type": "object",
      "description": "Root container for all performance harness data",
      "properties": {
        "version": {
          "type": "string",
          "description": "Version of the harness schema",
          "const": "1.0.0"
        },
        "runTimestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of the test run"
        },
        "commitSha": {
          "type": "string",
          "description": "The git commit SHA that was tested",
          "pattern": "^[a-f0-9]{7,40}$"
        },
        "environment": {
          "type": "string",
          "enum": ["CI", "local"],
          "description": "The environment where the test was run"
        },
        "snapshots": {
          "type": "array",
          "description": "Array of individual performance measurements",
          "items": {
            "$ref": "#/definitions/snapshot"
          }
        }
      },
      "required": ["version", "runTimestamp", "environment", "snapshots"]
    }
  },
  "required": ["performanceHarness"],
  "definitions": {
    "snapshot": {
      "type": "object",
      "description": "A single, atomic performance measurement",
      "properties": {
        "snapshotId": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for this specific measurement instance"
        },
        "scenarioId": {
          "type": "string",
          "description": "Dot-notation identifier for the test scenario",
          "examples": [
            "List.With1000Items.Filtered",
            "Compositor.StateUpdate",
            "TokenTransform.BrandSwitch",
            "UsageAggregation.Daily"
          ]
        },
        "metricName": {
          "type": "string",
          "description": "Dot-notation identifier for the specific metric being measured",
          "examples": [
            "React.actualDuration",
            "React.commitTime",
            "UserTiming.duration",
            "Lighthouse.LCP",
            "Lighthouse.TTI"
          ]
        },
        "value": {
          "type": "number",
          "description": "The measured numerical value of the metric",
          "minimum": 0
        },
        "unit": {
          "type": "string",
          "description": "The unit of measurement for the value",
          "enum": ["ms", "seconds", "bytes", "score"]
        },
        "browser": {
          "type": "string",
          "description": "The browser engine on which the test was executed",
          "enum": ["chromium", "firefox", "webkit"]
        },
        "parameters": {
          "type": "object",
          "description": "Key-value pairs describing the specific configuration of this run",
          "additionalProperties": true,
          "examples": [
            {
              "tenancyMode": "enterprise",
              "featureFlags": {
                "new-list-virtualization": true
              }
            }
          ]
        },
        "isRegression": {
          "type": "boolean",
          "description": "Flag indicating if this measurement was identified as a regression",
          "default": false
        },
        "baselineValue": {
          "type": "number",
          "description": "The baseline value against which this measurement was compared",
          "minimum": 0
        },
        "baselineSourceCommitSha": {
          "type": "string",
          "description": "The git commit SHA from which the baseline value was derived",
          "pattern": "^[a-f0-9]{7,40}$"
        }
      },
      "required": [
        "snapshotId",
        "scenarioId",
        "metricName",
        "value",
        "unit",
        "browser"
      ]
    }
  }
}
